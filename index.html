<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø·Ø© Ø±Ù…Ø¶Ø§Ù† - Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø®Ø· Cairo Ø§Ù„Ù…Ù…ÙŠØ² -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --emerald-900: #064e3b;
            --emerald-700: #047857;
            --emerald-500: #10b981;
            --blue-600: #2563eb;
            --amber-500: #f59e0b;
            --rose-600: #e11d48;
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-800: #1e293b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--slate-50);
            color: var(--slate-800);
            padding-bottom: 50px;
        }

        .container {
            max-width: 1100px;
            margin: 20px auto;
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid var(--slate-200);
        }

        header {
            background: linear-gradient(to right, var(--emerald-900), var(--emerald-700));
            padding: 25px 30px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-btn {
            position: absolute;
            top: 25px;
            left: 25px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .settings-btn:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(15deg); }

        .header-content h1 {
            font-size: 2.2rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .header-content p { font-weight: 500; opacity: 0.9; }

        .icon-yellow { color: #facc15; fill: #facc15; }

        nav {
            background: rgba(0,0,0,0.2);
            padding: 6px;
            border-radius: 16px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        nav button {
            background: none;
            border: none;
            color: white;
            padding: 10px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-family: 'Cairo', sans-serif;
            transition: 0.3s;
        }

        nav button.active {
            background: white;
            color: var(--emerald-900);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        main { padding: 20px; }
        
        @media (min-width: 768px) {
            main { padding: 35px; }
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Table Styling */
        .table-container {
            overflow-x: auto;
            border-radius: 20px;
            border: 1px solid var(--slate-200);
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 600px;
        }

        th, td {
            padding: 18px 15px;
            text-align: center;
            border-bottom: 1px solid var(--slate-100);
            white-space: nowrap;
        }

        th { 
            background-color: #f8fafc; 
            color: #475569; 
            font-weight: 800; 
            font-size: 0.95rem;
        }

        .section-divider {
            background-color: #f1f5f9;
            text-align: right;
            font-size: 0.9rem;
            font-weight: 800;
            color: var(--emerald-700);
            letter-spacing: 0.5px;
        }

        .checkbox-btn {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            border: 2px solid var(--slate-200);
            background: white;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            color: transparent;
        }
        
        .checkbox-btn:hover { border-color: var(--emerald-500); transform: scale(1.05); }

        .checkbox-btn.checked-quran { background: var(--emerald-500); color: white; border-color: var(--emerald-500); box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3); }
        .checkbox-btn.checked-other { background: var(--blue-600); color: white; border-color: var(--blue-600); box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3); }

        .footer-row { background: var(--slate-800); color: white; font-weight: 800; }

        /* Status Card */
        .daily-status-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 24px;
            padding: 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .zap-info { display: flex; gap: 15px; align-items: center; }
        .zap-icon { background: rgba(250, 204, 21, 0.15); padding: 12px; border-radius: 16px; color: #facc15; }
        .zap-info h4 { font-weight: 800; margin-bottom: 5px; }

        .daily-stats { display: flex; gap: 20px; }
        .stat-item { text-align: center; padding: 0 20px; border-left: 1px solid rgba(255,255,255,0.1); }
        .stat-value { display: block; font-size: 1.8rem; font-weight: 900; line-height: 1.2; }
        .highlight { color: var(--emerald-400); }

        /* Progress Tab Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .grid-card {
            padding: 25px 20px;
            border-radius: 24px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        .grid-card:hover { transform: translateY(-5px); }

        .grid-card.blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .grid-card.indigo { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .grid-card.amber { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .grid-card.emerald { background: linear-gradient(135deg, #10b981, #059669); }
        
        .grid-card .label { display: block; font-size: 0.9rem; opacity: 0.9; margin-top: 10px; font-weight: 600; }
        .grid-card .value { display: block; font-size: 1.6rem; font-weight: 900; margin-top: 5px; }

        .smart-status-card {
            background: white;
            padding: 40px;
            border-radius: 24px;
            border: 1px solid var(--slate-200);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .smart-status-card h2 { font-weight: 900; font-size: 1.8rem; margin-bottom: 10px; }

        .progress-bar-container {
            width: 100%;
            height: 14px;
            background: #f1f5f9;
            border-radius: 20px;
            margin: 25px 0;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: var(--emerald-500);
            border-radius: 20px;
            transition: width 1s ease;
        }

        .extra-stats { display: flex; justify-content: center; gap: 40px; margin-top: 25px; flex-wrap: wrap; }
        .extra-stats span { display: block; font-size: 2rem; font-weight: 900; color: var(--slate-800); }
        .extra-stats small { color: #64748b; font-weight: 600; }
        .divider { width: 1px; background: var(--slate-200); height: 50px; }

        /* Reflections */
        .reflection-section {
            background: white;
            padding: 30px;
            border-radius: 24px;
            border: 1px solid var(--slate-200);
        }

        .forms-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 25px;
        }
        @media (min-width: 768px) { .forms-grid { grid-template-columns: 1fr 1fr; } }
        
        .input-group label { display: block; margin-bottom: 10px; font-weight: 700; color: var(--slate-800); display: flex; align-items: center; gap: 8px; }

        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border-radius: 16px;
            border: 2px solid var(--slate-100);
            background: var(--slate-50);
            resize: none;
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            transition: 0.3s;
        }
        textarea:focus { outline: none; border-color: var(--blue-600); background: white; }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª) */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.6); 
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 30px;
            border-radius: 25px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            position: relative;
        }

        .close-modal {
            color: #94a3b8;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .close-modal:hover { color: var(--rose-600); }

        .settings-section { margin-bottom: 30px; }
        .settings-section h3 { margin-bottom: 20px; color: var(--slate-800); border-bottom: 2px solid var(--slate-100); padding-bottom: 10px; font-weight: 800; }
        
        /* ØªØµÙ…ÙŠÙ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .editable-habit-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            align-items: center;
        }

        .habit-name-input {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid var(--slate-200);
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            transition: 0.3s;
        }
        .habit-name-input:focus { border-color: var(--blue-600); outline: none; }

        .delete-habit-btn {
            background: #fee2e2;
            color: var(--rose-600);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .delete-habit-btn:hover { background: var(--rose-600); color: white; }

        .add-habit-btn {
            width: 100%;
            padding: 12px;
            background: #eff6ff;
            color: var(--blue-600);
            border: 2px dashed #bfdbfe;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: 0.2s;
        }
        .add-habit-btn:hover { background: #dbeafe; border-color: var(--blue-600); }

        .setting-input {
            width: 80px;
            padding: 10px;
            border-radius: 12px;
            border: 2px solid var(--slate-200);
            text-align: center;
            font-weight: bold;
            font-family: 'Cairo', sans-serif;
        }

        .save-btn {
            width: 100%;
            padding: 15px;
            background: var(--emerald-700);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: 800;
            font-family: 'Cairo', sans-serif;
            transition: 0.2s;
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3);
        }
        .save-btn:hover { background: var(--emerald-900); transform: translateY(-2px); }

        .khatma-info {
            font-size: 0.95rem;
            color: var(--emerald-800);
            background: #ecfdf5;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            border-right: 4px solid var(--emerald-500);
            font-weight: 600;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ */
        .backup-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .backup-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: 0.2s;
        }
        .btn-download { background: #f8fafc; border: 1px solid #e2e8f0; color: var(--slate-800); }
        .btn-download:hover { background: #f1f5f9; border-color: #cbd5e1; }
        
        .btn-upload { background: #f0f9ff; border: 1px solid #bae6fd; color: #0284c7; }
        .btn-upload:hover { background: #e0f2fe; border-color: #7dd3fc; }
        
        #fileInput { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header>
            <button class="settings-btn" onclick="openSettings()" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">
                <i data-lucide="sliders-horizontal"></i>
            </button>
            <div class="header-content">
                <h1><i data-lucide="moon" class="icon-yellow"></i> Ø®Ø·Ø© Ø±Ù…Ø¶Ø§Ù†</h1>
                <p>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø°Ø§ØªÙŠ Ø§Ù„Ù…Ø·ÙˆØ±</p>
            </div>
            <nav>
                <button onclick="showTab('daily')" id="btn-daily" class="active">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
                <button onclick="showTab('progress')" id="btn-progress">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù…</button>
            </nav>
        </header>

        <main>
            <!-- ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ -->
            <section id="daily-tab" class="tab-content active">
                <div class="table-container">
                    <table id="tracker-table">
                        <thead>
                            <tr id="table-header">
                                <th>Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</th>
                                <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
                        </tbody>
                        <tfoot>
                            <tr id="table-footer" class="footer-row">
                                <td>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</td>
                                <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹ Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- ÙƒØ§Ø±Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
                <div class="daily-status-card">
                    <div class="zap-info">
                        <div class="zap-icon"><i data-lucide="zap"></i></div>
                        <div>
                            <h4>ØªØ­Ù„ÙŠÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…</h4>
                            <p id="daily-analysis-text">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¨Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø¢Ù†</p>
                        </div>
                    </div>
                    <div class="daily-stats">
                        <div class="stat-item">
                            <span class="stat-label">Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</span>
                            <span class="stat-value" id="today-points">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</span>
                            <span class="stat-value highlight" id="today-quran">0</span>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
                <div class="chart-section">
                    <h3 style="margin-bottom: 20px; font-weight: 800;"><i data-lucide="bar-chart-3"></i> Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                    <div class="canvas-container" style="height: 300px;">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø¯Ù… -->
            <section id="progress-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="grid-card blue">
                        <i data-lucide="target"></i>
                        <span class="label">Ø§Ù„Ù‡Ø¯Ù</span>
                        <span class="value" id="target-khatmas-display">5 Ø®ØªÙ…Ø§Øª</span>
                    </div>
                    <div class="grid-card indigo">
                        <i data-lucide="trending-up"></i>
                        <span class="label">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
                        <span class="value" id="completion-rate-text">0%</span>
                    </div>
                    <div class="grid-card amber">
                        <i data-lucide="sun"></i>
                        <span class="label">Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
                        <span class="value" id="daily-pages-display">4 ØµÙØ­Ø§Øª</span>
                    </div>
                    <div class="grid-card emerald">
                        <i data-lucide="book-open"></i>
                        <span class="label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span>
                        <span class="value" id="total-quran-text">0 Ø¬Ø²Ø¡</span>
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø°ÙƒÙŠØ© -->
                <div class="smart-status-card">
                    <h2 id="status-label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</h2>
                    <p id="status-sub">Ø³Ø¬Ù„ Ø¹Ø¨Ø§Ø¯Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ØªØ¸Ù‡Ø± Ø­Ø§Ù„ØªÙƒ Ù‡Ù†Ø§.</p>
                    <div class="progress-bar-container">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <div class="extra-stats">
                        <div>
                            <span id="completed-khatmas">0.00</span>
                            <small>Ø®ØªÙ…Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</small>
                        </div>
                        <div class="divider"></div>
                        <div>
                            <span id="remaining-quran">30</span>
                            <small>Ø¬Ø²Ø¡ Ù…ØªØ¨Ù‚ÙŠ</small>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© -->
                <div class="reflection-section">
                    <h3 style="margin-bottom: 20px; font-weight: 800;"><i data-lucide="pencil-line"></i> Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h3>
                    <div class="forms-grid">
                        <div class="input-group">
                            <label><i data-lucide="message-square"></i> Ù„Ù…Ø§Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù‚ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ø¶Ø¹ÙŠÙØ§Ù‹ØŸ</label>
                            <textarea id="note-reason" placeholder="Ø§ÙƒØªØ¨ Ø£Ø³Ø¨Ø§Ø¨Ùƒ Ù‡Ù†Ø§..."></textarea>
                        </div>
                        <div class="input-group">
                            <label><i data-lucide="alert-circle"></i> Ù‡Ù„ Ø£Ù†Ø§ Ù…Ø§Ø´ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·Ø©ØŸ ÙˆÙƒÙŠÙ Ø£ØªØ­Ø³Ù†ØŸ</label>
                            <textarea id="note-eval" placeholder="Ø§ÙƒØªØ¨ Ø®Ø·ØªÙƒ Ù„Ù„ØªØ­Ø³Ù† Ù‡Ù†Ø§..."></textarea>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeSettings()">&times;</span>
            <h2 style="font-weight: 900; margin-bottom: 20px;"><i data-lucide="sliders-horizontal"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø·Ø©</h2>
            
            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØªÙ…Ø§Øª -->
            <div class="settings-section">
                <h3>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label style="font-weight: 700;">ÙƒÙ… Ø®ØªÙ…Ø© ØªØ±ÙŠØ¯ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŸ</label>
                    <input type="number" id="khatmaInput" class="setting-input" min="1" max="10" value="1" onchange="calcPagesPreview()">
                </div>
                <div id="khatmaPreview" class="khatma-info">
                    Ù„ØªØ­Ù‚ÙŠÙ‚ 1 Ø®ØªÙ…Ø©ØŒ Ø³ØªÙ‚Ø±Ø£ 4 ØµÙØ­Ø§Øª Ø¨Ø¹Ø¯ ÙƒÙ„ ØµÙ„Ø§Ø©.
                </div>
            </div>

            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ -->
            <div class="settings-section">
                <h3>ØªØ®ØµÙŠØµ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª</h3>
                <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 15px;">Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø³Ù…ÙŠØ§Øª Ø£Ùˆ Ø£Ø¶Ù Ø¹Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© (Ù…Ø«Ù„Ø§Ù‹: ØªØ±Ø§ÙˆÙŠØ­ØŒ Ù‚Ø±Ø§Ø¡Ø© ÙƒØªØ§Ø¨ØŒ ØµØ¯Ù‚Ø©...)</p>
                
                <div id="habitsListContainer">
                    <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
                </div>
                
                <button class="add-habit-btn" onclick="addNewHabitRow()">
                    <i data-lucide="plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>

            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
            <div class="settings-section">
                <h3>Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø©</h3>
                <p style="font-size: 0.85rem; color: #64748b;">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø². Ù„Ù†Ù‚Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡.</p>
                <div class="backup-actions">
                    <button class="backup-btn btn-download" onclick="exportData()">
                        <i data-lucide="download"></i> Ø­ÙØ¸ Ù…Ù„Ù
                    </button>
                    <button class="backup-btn btn-upload" onclick="document.getElementById('fileInput').click()">
                        <i data-lucide="upload"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù„Ù
                    </button>
                    <input type="file" id="fileInput" accept=".json" onchange="importData(this)">
                </div>
            </div>

            <button class="save-btn" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
        </div>
    </div>

    <script>
        // --- 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø© ---
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        let appData = JSON.parse(localStorage.getItem('ramadanAppData')) || Array.from({ length: 30 }, (_, i) => ({
            day: i + 1
            // Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª Ø³ØªØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
        }));

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¹Ø¯Ø¯ Ø§Ù„Ø®ØªÙ…Ø§Øª)
        let userConfig = JSON.parse(localStorage.getItem('ramadanUserConfig')) || {
            targetKhatmas: 1
        };

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©
        let customHabits = JSON.parse(localStorage.getItem('ramadanCustomHabits')) || [
            { id: 'h_qiyam', label: 'Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„' },
            { id: 'h_prayers', label: 'Ø§Ù„ØµÙ„ÙˆØ§Øª ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§' },
            { id: 'h_sunnah', label: 'Ø§Ù„Ø³Ù†Ù† Ø§Ù„Ø±ÙˆØ§ØªØ¨' },
            { id: 'h_dhikr', label: 'Ø£Ø°ÙƒØ§Ø± ÙŠÙˆÙ…ÙŠØ©' },
            { id: 'h_selfControl', label: 'Ø¶Ø¨Ø· Ø§Ù„Ù†ÙØ³' }
        ];

        const quranHabits = [
            { key: 'fajr', label: 'Ø¨Ø¹Ø¯ Ø§Ù„ÙØ¬Ø±' },
            { key: 'dhuhr', label: 'Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±' },
            { key: 'asr', label: 'Ø¨Ø¹Ø¯ Ø§Ù„Ø¹ØµØ±' },
            { key: 'maghrib', label: 'Ø¨Ø¹Ø¯ Ø§Ù„Ù…ØºØ±Ø¨' },
            { key: 'isha', label: 'Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø´Ø§Ø¡' },
        ];

        let myChart = null;

        // --- 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Modal Logic) ---

        function openSettings() {
            document.getElementById('settingsModal').style.display = "block";
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ØªÙ…Ø§Øª
            document.getElementById('khatmaInput').value = userConfig.targetKhatmas;
            calcPagesPreview();

            // Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
            renderSettingsHabitsList();
            
            lucide.createIcons();
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = "none";
        }

        function renderSettingsHabitsList() {
            const container = document.getElementById('habitsListContainer');
            container.innerHTML = ''; // ØªÙØ±ÙŠØº Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

            customHabits.forEach((habit, index) => {
                const div = document.createElement('div');
                div.className = 'editable-habit-row';
                div.innerHTML = `
                    <input type="text" class="habit-name-input" value="${habit.label}" id="habit-input-${index}" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¯Ø©...">
                    <button class="delete-habit-btn" onclick="deleteHabitRow(${index})">
                        <i data-lucide="trash-2"></i>
                    </button>
                `;
                container.appendChild(div);
            });
            lucide.createIcons();
        }

        function addNewHabitRow() {
            customHabits.push({ id: `h_${Date.now()}`, label: 'Ø¹Ø¨Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©' });
            renderSettingsHabitsList();
        }

        function deleteHabitRow(index) {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ø§Ø¯Ø©ØŸ")) {
                customHabits.splice(index, 1);
                renderSettingsHabitsList();
            }
        }

        function calcPagesPreview() {
            const k = document.getElementById('khatmaInput').value;
            const pagesPerDay = (604 * k) / 30;
            const pagesPerPrayer = Math.ceil(pagesPerDay / 5);
            document.getElementById('khatmaPreview').innerText = 
                `Ù„ØªØ­Ù‚ÙŠÙ‚ ${k} Ø®ØªÙ…Ø©ØŒ Ø³ØªÙ‚Ø±Ø£ ${pagesPerPrayer} ØµÙØ­Ø§Øª ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ø¨Ø¹Ø¯ ÙƒÙ„ ØµÙ„Ø§Ø©.`;
        }

        function saveSettings() {
            userConfig.targetKhatmas = parseInt(document.getElementById('khatmaInput').value) || 1;

            const inputs = document.querySelectorAll('.habit-name-input');
            inputs.forEach((input, index) => {
                if (customHabits[index]) {
                    customHabits[index].label = input.value;
                }
            });

            customHabits = customHabits.filter(h => h.label.trim() !== "");

            localStorage.setItem('ramadanUserConfig', JSON.stringify(userConfig));
            localStorage.setItem('ramadanCustomHabits', JSON.stringify(customHabits));
            
            closeSettings();
            initTable();
            updateProgress();
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Ø¬Ø¯ÙŠØ¯) ---
        function exportData() {
            const data = {
                appData: appData,
                userConfig: userConfig,
                customHabits: customHabits,
                noteReason: localStorage.getItem('noteReason') || '',
                noteEval: localStorage.getItem('noteEval') || ''
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "ramadan_plan_backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.appData && data.userConfig) {
                        appData = data.appData;
                        userConfig = data.userConfig;
                        customHabits = data.customHabits || customHabits;
                        
                        localStorage.setItem('ramadanAppData', JSON.stringify(appData));
                        localStorage.setItem('ramadanUserConfig', JSON.stringify(userConfig));
                        localStorage.setItem('ramadanCustomHabits', JSON.stringify(customHabits));
                        if(data.noteReason) localStorage.setItem('noteReason', data.noteReason);
                        if(data.noteEval) localStorage.setItem('noteEval', data.noteEval);

                        alert("ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
                        location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    } else {
                        alert("Ø¹ÙÙˆØ§Ù‹ØŒ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­.");
                    }
                } catch (error) {
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù.");
                }
            };
            reader.readAsText(file);
        }

        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target == modal) closeSettings();
        }

        // --- 3. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ---

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.getElementById(`btn-${tabName}`).classList.add('active');
            
            if (tabName === 'progress') updateProgress();
        }

        function initTable() {
            const headerRow = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');
            const footerRow = document.getElementById('table-footer');

            headerRow.innerHTML = '<th>Ø§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</th>';
            tableBody.innerHTML = '';
            footerRow.innerHTML = '<td>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</td>';

            const daysToShow = appData.slice(0, 7);
            
            daysToShow.forEach(d => {
                const th = document.createElement('th');
                th.innerText = `ÙŠÙˆÙ… ${d.day}`;
                headerRow.appendChild(th);
            });

            const pagesPerDay = (604 * userConfig.targetKhatmas) / 30;
            const pagesPerPrayer = Math.ceil(pagesPerDay / 5);

            const quranHeader = document.createElement('tr');
            quranHeader.className = 'section-divider';
            quranHeader.innerHTML = `<td colspan="${daysToShow.length + 1}">ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… (${pagesPerPrayer} ØµÙØ­Ø§Øª Ù„ÙƒÙ„ ØµÙ„Ø§Ø©)</td>`;
            tableBody.appendChild(quranHeader);

            const dynamicQuranHabits = quranHabits.map(h => ({
                ...h,
                displayLabel: `${h.label} (${pagesPerPrayer} Øµ)`
            }));

            renderHabitRows(dynamicQuranHabits, 'quran', tableBody, daysToShow);

            if (customHabits.length > 0) {
                const otherHeader = document.createElement('tr');
                otherHeader.className = 'section-divider';
                otherHeader.innerHTML = `<td colspan="${daysToShow.length + 1}" style="color: #2563eb">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· ÙˆØ§Ù„Ø¹Ø¨Ø§Ø¯Ø§Øª</td>`;
                tableBody.appendChild(otherHeader);
                
                renderHabitRows(customHabits, 'other', tableBody, daysToShow);
            }

            updateTotals();
            initChart();
            lucide.createIcons();
        }

        function renderHabitRows(habits, type, parent, daysSlice) {
            habits.forEach(habit => {
                const habitKey = habit.id || habit.key;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${habit.displayLabel || habit.label}</td>`;
                
                daysSlice.forEach((day, index) => {
                    const realIndex = day.day - 1;
                    const td = document.createElement('td');
                    const btn = document.createElement('button');
                    btn.className = 'checkbox-btn';
                    
                    const isChecked = appData[realIndex][habitKey] === true;

                    if (isChecked) {
                        btn.classList.add(type === 'quran' ? 'checked-quran' : 'checked-other');
                        btn.innerHTML = '<i data-lucide="check"></i>';
                        btn.style.color = "white";
                    } else {
                        btn.innerHTML = '<i data-lucide="check"></i>';
                    }

                    btn.onclick = () => toggleCheck(realIndex, habitKey, btn, type);
                    td.appendChild(btn);
                    tr.appendChild(td);
                });
                parent.appendChild(tr);
            });
        }

        function toggleCheck(dayIndex, key, btn, type) {
            const currentVal = appData[dayIndex][key] === true;
            appData[dayIndex][key] = !currentVal;
            
            localStorage.setItem('ramadanAppData', JSON.stringify(appData));

            if (appData[dayIndex][key]) {
                btn.classList.add(type === 'quran' ? 'checked-quran' : 'checked-other');
                btn.style.color = "white"; 
            } else {
                btn.classList.remove('checked-quran', 'checked-other');
                btn.style.color = "transparent"; 
            }
            
            lucide.createIcons();
            updateTotals();
            updateChart();
            updateDailyAnalysis();
        }

        function updateTotals() {
            const footerRow = document.getElementById('table-footer');
            while (footerRow.cells.length > 1) footerRow.deleteCell(1);

            const daysToShow = appData.slice(0, 7); 
            const activeKeys = [...quranHabits.map(h=>h.key), ...customHabits.map(h=>h.id)];

            daysToShow.forEach(day => {
                const total = activeKeys.reduce((sum, key) => sum + (day[key] ? 1 : 0), 0);
                const td = document.createElement('td');
                td.innerText = total;
                if (total >= (activeKeys.length * 0.8)) td.style.color = '#10b981';
                footerRow.appendChild(td);
            });
        }

        function updateDailyAnalysis() {
            const today = appData[0];
            const activeKeys = [...quranHabits.map(h=>h.key), ...customHabits.map(h=>h.id)];
            
            const points = activeKeys.reduce((sum, key) => sum + (today[key] ? 1 : 0), 0);
            const quran = quranHabits.reduce((sum, h) => sum + (today[h.key] ? 1 : 0), 0);

            const pagesPerPrayer = Math.ceil(((604 * userConfig.targetKhatmas) / 30) / 5);
            const pagesDone = quran * pagesPerPrayer;

            document.getElementById('today-points').innerText = points;
            document.getElementById('today-quran').innerText = pagesDone + " Øµ";
            
            const ratio = points / activeKeys.length;
            let msg = 'Ø¨Ø¯Ø§ÙŠØ© Ø¬ÙŠØ¯Ø©ØŒ Ø§Ø³ØªÙ…Ø±!';
            if(ratio > 0.9) msg = 'Ø£Ø¯Ø§Ø¡ Ø£Ø³Ø·ÙˆØ±ÙŠ! Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰.';
            else if(ratio < 0.5) msg = 'Ø­Ø§ÙˆÙ„ ØªØ¹ÙˆÙŠØ¶ Ù…Ø§ ÙØ§ØªÙƒØŒ Ø±Ù…Ø¶Ø§Ù† ÙØ±ØµØ©.';
            
            document.getElementById('daily-analysis-text').innerText = msg;
        }

        function updateProgress() {
            const totalTargetPages = 604 * userConfig.targetKhatmas;
            const pagesPerCheck = Math.ceil(((604 * userConfig.targetKhatmas) / 30) / 5);
            
            let totalChecks = 0;
            appData.forEach(day => {
                quranHabits.forEach(h => {
                    if(day[h.key]) totalChecks++;
                });
            });

            const pagesDone = totalChecks * pagesPerCheck;
            const rate = totalTargetPages > 0 ? (pagesDone / totalTargetPages) * 100 : 0;
            const khatmasDone = pagesDone / 604;

            document.getElementById('target-khatmas-display').innerText = `${userConfig.targetKhatmas} Ø®ØªÙ…Ø§Øª`;
            document.getElementById('daily-pages-display').innerText = `${pagesPerCheck * 5} ØµÙØ­Ø©/ÙŠÙˆÙ…`;
            document.getElementById('total-quran-text').innerText = `${pagesDone} ØµÙØ­Ø©`;
            document.getElementById('completion-rate-text').innerText = `${Math.round(rate)}%`;
            document.getElementById('progress-fill').style.width = `${Math.min(rate, 100)}%`;
            
            document.getElementById('completed-khatmas').innerText = khatmasDone.toFixed(2);
            document.getElementById('remaining-quran').innerText = Math.max(0, 30 - (pagesDone/20)).toFixed(0);

            const statusLabel = document.getElementById('status-label');
            const statusSub = document.getElementById('status-sub');
            const fill = document.getElementById('progress-fill');
            const expectedProgress = (1 / 30) * 100;

            if (rate >= expectedProgress) {
                statusLabel.innerText = "Ø£Ø¯Ø§Ø¡ Ù…Ø«Ø§Ù„ÙŠ! ğŸ†";
                statusLabel.style.color = "#10b981";
                statusSub.innerText = "Ø£Ù†Øª ØªØ³ÙŠØ± ÙˆÙÙ‚ Ø§Ù„Ø®Ø·Ø© ØªÙ…Ø§Ù…Ø§Ù‹.";
                fill.style.backgroundColor = "#10b981";
            } else {
                statusLabel.innerText = "ØªØ­ØªØ§Ø¬ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬Ù‡Ø¯ ğŸ’ª";
                statusLabel.style.color = "#f59e0b";
                statusSub.innerText = "Ø£Ù†Øª Ù…ØªØ£Ø®Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù‡Ø¯Ù.";
                fill.style.backgroundColor = "#f59e0b";
            }
        }

        function initChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const activeKeys = [...quranHabits.map(h=>h.key), ...customHabits.map(h=>h.id)];

            if (myChart) myChart.destroy();
            
            Chart.defaults.font.family = "'Cairo', sans-serif";

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: appData.slice(0, 7).map(d => `ÙŠÙˆÙ… ${d.day}`),
                    datasets: [{
                        label: 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·',
                        data: appData.slice(0, 7).map(day => 
                             activeKeys.reduce((sum, key) => sum + (day[key] ? 1 : 0), 0)
                        ),
                        borderColor: '#10b981',
                        borderWidth: 4,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#10b981',
                        pointBorderWidth: 3,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: activeKeys.length + 2, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function updateChart() {
            if (myChart) {
                const activeKeys = [...quranHabits.map(h=>h.key), ...customHabits.map(h=>h.id)];
                myChart.data.datasets[0].data = appData.slice(0, 7).map(day => 
                    activeKeys.reduce((sum, key) => sum + (day[key] ? 1 : 0), 0)
                );
                myChart.options.scales.y.max = activeKeys.length + 2;
                myChart.update();
            }
        }

        window.onload = function() {
            initTable();
            lucide.createIcons();
            document.getElementById('note-reason').value = localStorage.getItem('noteReason') || '';
            document.getElementById('note-eval').value = localStorage.getItem('noteEval') || '';
        };

        document.getElementById('note-reason').addEventListener('input', (e) => localStorage.setItem('noteReason', e.target.value));
        document.getElementById('note-eval').addEventListener('input', (e) => localStorage.setItem('noteEval', e.target.value));

    </script>
</body>
</html>